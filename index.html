<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>ESP32 Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial;
  background: #f2f4f7;
}

.header {
  background: linear-gradient(90deg,#0d47a1,#1976d2);
  color: white;
  padding: 18px 30px;
  font-size: 26px;
}

.container {
  padding: 20px;
  display: grid;
  gap: 20px;
}

.card {
  background: white;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,.08);
}
</style>
</head>

<body>

<div class="header">Temperature & Humidity Dashboard</div>

<div class="container">

  <div class="card">
    <h3>Temperature (°C)</h3>
    <canvas id="tempChart"></canvas>
  </div>

  <div class="card">
    <h3>Humidity (%)</h3>
    <canvas id="humChart"></canvas>
  </div>

</div>

<script>
// ====== ใส่ Channel ID ของคุณ ======
const channels = [
  { id: 'CHANNEL_ID_1', name: 'Channel 1', color: 'red' },
  { id: 'CHANNEL_ID_2', name: 'Channel 2', color: 'blue' },
  { id: 'CHANNEL_ID_3', name: 'Channel 3', color: 'green' }
];

// ====== Chart Setup ======
const tempChart = new Chart(document.getElementById('tempChart'), {
  type: 'line',
  data: { labels: [], datasets: [] }
});

const humChart = new Chart(document.getElementById('humChart'), {
  type: 'line',
  data: { labels: [], datasets: [] }
});

// ====== Load Data ======
async function loadData() {
  tempChart.data.labels = [];
  tempChart.data.datasets = [];
  humChart.data.labels = [];
  humChart.data.datasets = [];

  for (let ch of channels) {
    const res = await fetch(
      `https://api.thingspeak.com/channels/${ch.id}/feeds.json?results=20`
    );
    const data = await res.json();

    const labels = data.feeds.map(f =>
      new Date(f.created_at).toLocaleTimeString()
    );

    const temp = data.feeds.map(f => f.field1);
    const hum = data.feeds.map(f => f.field2);

    tempChart.data.labels = labels;
    humChart.data.labels = labels;

    tempChart.data.datasets.push({
      label: ch.name,
      data: temp,
      borderColor: ch.color,
      fill: false
    });

    humChart.data.datasets.push({
      label: ch.name,
      data: hum,
      borderColor: ch.color,
      fill: false
    });
  }

  tempChart.update();
  humChart.update();
}

loadData();
setInterval(loadData, 20000); // อัปเดตทุก 20 วิ
</script>

</body>
</html>
